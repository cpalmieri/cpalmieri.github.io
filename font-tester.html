<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CSS Font Stack Sandbox</title>
  <style>
    :root{
      --ui-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica Neue, Arial, sans-serif;
      --stack: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Yu Gothic Medium", "Yu Gothic", "Segoe UI", Roboto, "Noto Sans JP", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
      --fw: 400;           /* body fallback weight */
      --fw-h1: 700;        /* heading 1 weight */
      --fw-h2: 600;        /* heading 2 weight */
      --fw-p: 400;         /* paragraph weight */
      --base: 16;          /* px */
      --col: 48ch;         /* content column width */
      --bg: #0b0c0f;       /* UI background */
      --ink: #e6e8eb;      /* UI text */
      --muted: #a4acb9;
      --panel: #14161b;
      --accent: #4da3ff;
      --border: #2a2f39;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--ui-font);
      background: var(--bg);
      color: var(--ink);
      display: grid;
      grid-template-columns: 360px 1fr;
      min-height: 100dvh;
    }

    /* Left panel */
    .controls {
      padding: 16px;
      background: var(--panel);
      border-right: 1px solid var(--border);
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 16px;
    }
    .controls h1{
      font-size: 18px;
      margin: 0;
      font-weight: 600;
      letter-spacing: .2px;
    }
    .group { display: grid; gap: 10px; }
    .field { display: grid; gap: 8px; }
    .field label { font-size: 12px; color: var(--muted); }
    textarea, input[type="text"], input[type="number"], select {
      width: 100%;
      background: #0e1014;
      color: var(--ink);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      font: 13px/1.4 var(--ui-font);
      resize: vertical;
    }
    textarea.code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

    .actions { display: flex; gap: 8px; }
    button {
      appearance: none;
      border: 1px solid var(--border);
      background: #0e1014;
      color: var(--ink);
      font: 13px/1 var(--ui-font);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
    }
    button.primary { border-color: color-mix(in oklab, var(--accent) 60%, var(--border)); background: color-mix(in oklab, var(--accent) 15%, #0e1014); }

    /* Right preview area */
    .preview-wrap {
      padding: 28px clamp(16px, 3vw, 40px);
      overflow: auto;
    }
    .sheet {
      font-family: var(--stack);
      font-weight: var(--fw);
      font-size: calc(var(--base) * 1px);
      line-height: 1.5;
    }
    .column { max-width: var(--col); }

    /* Typography */
    .sheet h1 { font-size: clamp(1.8rem, 2.2rem + 1vw, 3.2rem); line-height: 1.15; margin: 0 0 .6em; font-weight: var(--fw-h1); }
    .sheet h2 { font-size: clamp(1.1rem, 1.1rem + .4vw, 1.4rem); line-height: 1.25; margin: 0 0 .6em; opacity: .85; font-weight: var(--fw-h2); }
    .sheet p  { margin: 0 0 1em; font-weight: var(--fw-p); }
    .sheet code, .sheet pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    @media (max-width: 800px) {
      body { grid-template-columns: 1fr; }
      .controls { border-right: none; border-bottom: 1px solid var(--border); }
    }
  </style>
</head>
<body>
  <aside class="controls" aria-label="Controls panel">
    <h1>CSS Font Stack Sandbox</h1>
    <div class="group">
      <div class="field">
        <label for="stack">Font family stack (comma-separated)</label>
        <textarea id="stack" class="code" rows="4" spellcheck="false">-apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Yu Gothic Medium", "Yu Gothic", "Segoe UI", Roboto, "Noto Sans JP", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", sans-serif</textarea>
      </div>

      <div class="row3" role="group" aria-label="Font weights by element">
        <div class="field">
          <label for="w-h1">H1 weight</label>
          <select id="w-h1"></select>
        </div>
        <div class="field">
          <label for="w-h2">H2 weight</label>
          <select id="w-h2"></select>
        </div>
        <div class="field">
          <label for="w-p">Paragraph weight</label>
          <select id="w-p"></select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="size">Base size (px)</label>
          <input id="size" type="number" min="8" max="48" step="1" value="16" />
        </div>
        <div class="field">
          <label for="width">Text column width (accepts units, e.g. <code>48ch</code>, <code>640px</code>, <code>40rem</code>)</label>
          <input id="width" type="text" value="48ch" />
        </div>
      </div>

      <div class="field">
        <label for="markup">Markup &amp; content (HTML allowed)</label>
        <textarea id="markup" class="code" rows="10" spellcheck="false"><h1>日本語と English: Heading One</h1>
<h2>Small Heading / 見出し</h2>
<p>Grumpy wizards make toxic brew for the evil queen. すもももももももものうち。12345 ABCXYZ あいうえお カタカナ ｶﾀｶﾅ 漢字。</p></textarea>
      </div>
    </div>
    <div class="actions">
      <button id="reset">Reset</button>
      <button id="save" class="primary" title="Save settings to this browser">Save</button>
      <button id="clear">Clear Save</button>
    </div>
  </aside>

  <main class="preview-wrap" aria-label="Preview area">
    <div id="sheet" class="sheet">
      <div class="column" id="column">
        <!-- Content injected here -->
      </div>
    </div>
  </main>

  <script>
    const els = {
      stack: document.getElementById('stack'),
      size: document.getElementById('size'),
      width: document.getElementById('width'),
      markup: document.getElementById('markup'),
      sheet: document.getElementById('sheet'),
      column: document.getElementById('column'),
      reset: document.getElementById('reset'),
      save: document.getElementById('save'),
      clear: document.getElementById('clear'),
      wH1: document.getElementById('w-h1'),
      wH2: document.getElementById('w-h2'),
      wP: document.getElementById('w-p'),
    };

    const DEFAULTS = {
      stack: getComputedStyle(document.documentElement).getPropertyValue('--stack').trim(),
      wH1: '700',
      wH2: '600',
      wP: '400',
      size: '16',
      width: '48ch',
      markup: `<h1>日本語と English: Heading One</h1>\n<h2>Small Heading / 見出し</h2>\n<p>Grumpy wizards make toxic brew for the evil queen. すもももももももものうち。12345 ABCXYZ あいうえお カタカナ ｶﾀｶﾅ 漢字。</p>`
    };

    function populateWeightSelect(sel){
      sel.innerHTML = '';
      for(let v=100; v<=900; v+=100){
        const opt = document.createElement('option');
        opt.value = String(v);
        opt.textContent = v;
        sel.appendChild(opt);
      }
    }

    // Fill dropdowns once
    [els.wH1, els.wH2, els.wP].forEach(populateWeightSelect);

    function applyAll(){
      // Font stack
      document.documentElement.style.setProperty('--stack', els.stack.value);
      // Element-specific weights
      const h1 = parseInt(els.wH1.value || DEFAULTS.wH1, 10);
      const h2 = parseInt(els.wH2.value || DEFAULTS.wH2, 10);
      const p  = parseInt(els.wP.value  || DEFAULTS.wP, 10);
      document.documentElement.style.setProperty('--fw-h1', String(h1));
      document.documentElement.style.setProperty('--fw-h2', String(h2));
      document.documentElement.style.setProperty('--fw-p',  String(p));
      // Base size
      const size = Math.max(8, Math.min(72, parseInt(els.size.value || '16')));
      document.documentElement.style.setProperty('--base', String(size));
      // Column width (accepts units; if number only, assume ch)
      const raw = (els.width.value || '').trim();
      const col = /^(\d+)(?:\s*)$/.test(raw) ? RegExp.$1 + 'ch' : raw;
      document.documentElement.style.setProperty('--col', col);
      // Markup
      els.column.innerHTML = els.markup.value;
    }

    function loadSaved(){
      try {
        const saved = JSON.parse(localStorage.getItem('fontSandboxSaved') || 'null');
        if(!saved) return;
        els.stack.value = saved.stack ?? els.stack.value;
        els.wH1.value = saved.wH1 ?? DEFAULTS.wH1;
        els.wH2.value = saved.wH2 ?? DEFAULTS.wH2;
        els.wP.value  = saved.wP  ?? DEFAULTS.wP;
        els.size.value = saved.size ?? els.size.value;
        els.width.value = saved.width ?? els.width.value;
        els.markup.value = saved.markup ?? els.markup.value;
      } catch(e) { /* ignore */ }
    }

    function save(){
      const snapshot = {
        stack: els.stack.value,
        wH1: els.wH1.value,
        wH2: els.wH2.value,
        wP:  els.wP.value,
        size: els.size.value,
        width: els.width.value,
        markup: els.markup.value
      };
      localStorage.setItem('fontSandboxSaved', JSON.stringify(snapshot));
    }

    function reset(){
      els.stack.value = DEFAULTS.stack;
      els.wH1.value = DEFAULTS.wH1;
      els.wH2.value = DEFAULTS.wH2;
      els.wP.value  = DEFAULTS.wP;
      els.size.value = DEFAULTS.size;
      els.width.value = DEFAULTS.width;
      els.markup.value = DEFAULTS.markup;
      applyAll();
    }

    // Live update handlers
    ['input','change'].forEach(evt => {
      els.stack.addEventListener(evt, applyAll);
      els.wH1.addEventListener(evt, applyAll);
      els.wH2.addEventListener(evt, applyAll);
      els.wP.addEventListener(evt, applyAll);
      els.size.addEventListener(evt, applyAll);
      els.width.addEventListener(evt, applyAll);
      els.markup.addEventListener(evt, applyAll);
    });

    els.reset.addEventListener('click', reset);
    els.save.addEventListener('click', () => { save(); applyAll(); });
    els.clear.addEventListener('click', () => { localStorage.removeItem('fontSandboxSaved'); });

    // Initialize
    loadSaved();
    // Ensure defaults selected if no saved values yet
    if(!els.wH1.value) els.wH1.value = DEFAULTS.wH1;
    if(!els.wH2.value) els.wH2.value = DEFAULTS.wH2;
    if(!els.wP.value)  els.wP.value  = DEFAULTS.wP;
    applyAll();
  </script>
</body>
</html>
